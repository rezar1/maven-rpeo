<<<<<<< HEAD
# DDDé¢†åŸŸé©±åŠ¨è®¾è®¡åœ¨ä¸­å°å‹é¡¹ç›®é‡Œçš„è½åœ°å®ç°
---


@[TOC](æ–‡ç« ç›®å½•)

---

# å‰è¨€
å¯¹äºç°åœ¨äº¤äº’æ¨¡å¼çš„ä¸šåŠ¡ç³»ç»Ÿè€Œè¨€ï¼Œæ™®éè¿½æ±‚å¼€å‘è¿­ä»£æ•ˆç‡é«˜ï¼Œç³»ç»Ÿè‡ªèº«çš„é«˜å¯ç”¨ç­‰åŸºç¡€èƒ½åŠ›ã€‚è§£å†³æ–¹æ¡ˆä¹‹ä¸€ä¾¿æ˜¯å¼•å…¥å¾®æœåŠ¡æ¶æ„ã€‚é€šè¿‡ä¸šåŠ¡æ‹†åˆ†ï¼ŒæœåŠ¡å†—ä½™ï¼Œè¯·æ±‚åˆ†æµï¼Œå¿«é€Ÿæ‰©å±•ç­‰æ–¹å¼æ¥æ»¡è¶³ä»¥ä¸Šè¦æ±‚ã€‚è€Œå…·ä½“å¾®æœåŠ¡æ¶æ„çš„è®¾è®¡ï¼Œä¾¿å¯ä»¥åŸºäºDDDçš„æŒ‡å¯¼æ€æƒ³æ¥å®Œæˆã€‚

DDDæ˜¯ä¸€å¥—è®¾è®¡æ–¹æ³•ï¼Œä»å¤§ç²’åº¦çš„ä¸šåŠ¡é¢†åŸŸæ¥çœ‹ï¼ŒDDDè®¾è®¡æ€æƒ³å°±åƒæ˜¯ä¸¤ç§ä»£ç è®¾è®¡åŸåˆ™çš„æ›´å¹¿å±‚æ¬¡çš„æ¨å¹¿(é«˜å†…èšï¼Œä½è€¦åˆ/å•ä¸€èŒè´£)ï¼Œç›®çš„æ˜¯è¯†åˆ«æ‹†åˆ†å‡ºèŒè´£ä¸åŒçš„æ›´å°ç²’åº¦çš„å¹¶ä¸”è‡ªèº«åŠŸèƒ½é«˜åº¦å†…èšçš„æœåŠ¡é›†åˆï¼›ä»ä¸šåŠ¡æµè½¬å±‚é¢æ¥è¯´ï¼Œå¼ºè°ƒçš„æ˜¯ä¸šåŠ¡ä¹‹é—´çš„å¼‚æ­¥é©±åŠ¨å’Œç¼–æ’ï¼›ä»ä¸šåŠ¡æ•°æ®å±‚é¢è¯´ï¼Œå¼ºè°ƒçš„æ˜¯éš”ç¦»å’Œæœ€ç»ˆä¸€è‡´ã€‚

ç®€å•è¯´å¼•å…¥DDDæ¶æ„å…·æœ‰ä»¥ä¸‹å‡ ä¸ªå¥½å¤„ï¼š

```java
1. å¼€å‘æ–¹å¼æ›´ä¸ç°å®æƒ…å†µå¥‘åˆï¼ŒåŸºäºæŠ½è±¡åŒ–çš„é¢†åŸŸçŸ¥è¯†ï¼Œé‡‡ç”¨è‡ªé¡¶å‘ä¸‹çš„å¼€å‘æ–¹å¼ï¼Œä¸“æ³¨äºåœ¨é¢†åŸŸæ¨¡å‹å†…éƒ¨å®Œæˆç°å®æ¦‚å¿µçš„ä¿¡æ¯å†…èšï¼Œæ¦‚å¿µè¡Œä¸ºçš„å†…éƒ¨è¡¨è¾¾ã€‚å±è”½åº•å±‚åº“è¡¨è®¾è®¡ä»¥åŠé¿å…æ•°æ®å­˜å‚¨æ–¹å¼å¸¦æ¥çš„ä¸šåŠ¡è¡¨è¾¾ä¸Šçš„å¦¥å(å¦‚æŒ£æ‰äºå°†å¯¹è±¡çš„å±æ€§æ˜ å°„åˆ°è¡¨é‡Œå¹¶æ»¡è¶³æ•°æ®åº“çš„èŒƒå¼è¦æ±‚).

2. é¢†åŸŸæ¨¡å‹ä½œä¸ºåŠŸèƒ½é»‘ç›’ï¼Œåªæä¾›å¿…è¦çš„è¾“å…¥è¾“å‡ºåŒå¤–ç•Œäº¤äº’ã€‚æ¦‚å¿µè¾¹ç•Œæ¸…æ™°ï¼Œé«˜åº¦è‡ªæ²»ï¼Œæ•°æ®äº‹åŠ¡æ€§å†²çªé™ä½ï¼Œæ˜“äºå›¢é˜Ÿèšç„¦å¼€å‘å’ŒæœåŠ¡çš„ä¸­å°åŒ–ã€‚

3. ä»¥äº‹ä»¶é©±åŠ¨ä½œä¸ºä¸šåŠ¡ç¼–æ’çš„é‡è¦é€”å¾„ï¼Œç³»ç»Ÿå¹¶è¡Œç¨‹åº¦é«˜ï¼Œä¸šåŠ¡ä¹‹é—´çš„è€¦åˆç¨‹åº¦é™ä½ï¼Œå¯ä»¥ç®€åŒ–ä¸€ä¸ªå¤æ‚ä¸šåŠ¡æ¨¡å‹çš„å¼€å‘æ­¥éª¤.

4. æä¾›äº†å„ç§è®¾è®¡çº¦æŸå’Œä¸šåŠ¡ä¿éšœçš„æ–¹æ³•è®ºï¼Œæœ‰åŠ©äºç»Ÿä¸€å›¢é˜Ÿçš„å¼€å‘é£æ ¼å’ŒæŠ€æœ¯æ ˆä¾èµ–.
```
æœ¬æ–‡ä¸å…·ä½“æ¶‰åŠDDDæ€æƒ³ä¸­æ‰€åŒ…å«æ¦‚å¿µçš„è¯¦ç»†è¯´æ˜ï¼Œä¸»è¦æ˜¯é€šè¿‡ğŸ‘‡è¿™ä¸ªå…·ä½“é¡¹ç›®æ¥èµ°ä¸€éæ¶æ„è½åœ°æµç¨‹ï¼ŒæŠ›ä¸ªæ¿ç –å¼•å—ç‰ã€‚

```java
 ç§åŸŸå¼•æµé¢†åŸŸç¡®å®šå¤šå¼•æµæ¸ é“æ¥æºé‡Œå•ä¸€ç”¨æˆ·çš„æœ€æ—©é‚€è¯·é“¾æ¡å…³ç³»

 å¼•æµæ¸ é“åŒ…æ‹¬:
	1. ä¼ä¸šå¾®ä¿¡ç¾¤èŠ
	2. ä¸ªäººå¾®ä¿¡ç¾¤èŠ
	3. å°ç¨‹åº
	4. å…¬ä¼—å·

 æ¸ é“1,2 ç”±ç¬¬ä¸‰æ–¹æ¥å£æ‹‰å›ç¾¤ç»„æˆå‘˜ä¿¡æ¯; 3,4 ç”±ç«¯ä¸Šå®æ—¶ä¸ŠæŠ¥æˆæƒç”¨æˆ·çš„è®¿é—®ä¿¡æ¯
ã€å”¯ä¸€ç”¨æˆ·ã€‘çš„å½’ç±»åŸºäºæ˜µç§°ä¸€è‡´ï¼Œå¤´åƒç›¸ä¼¼åº¦ï¼Œåœ°åŸŸä¸€è‡´ï¼Œæ‰‹åŠ¨æ ‡è®°ç­‰æ–¹å¼å®Œæˆ
 ç”¨æˆ·é‚€è¯·å…³ç³»é“¾æ¡ä¸ºå‘˜å·¥å¼•æµä¸šç»©ï¼Œå•†å“å”®å–æä¾›åŸºç¡€è®¡ç®—æ•°æ®
 
 è¦æ±‚:
 	1. å®æ—¶æ„å»ºç”¨æˆ·æ‰€å±çš„æœ€æ—©é‚€è¯·é“¾æ¡
 	2. é‚€è¯·èŠæ¡æ„å»ºè¿‡ç¨‹ä¸­ä¸å½±å“å½“å‰å®æ—¶é“¾æ¡æ•°æ®çš„é«˜é¢‘æ¬¡æŸ¥è¯¢
 	3. æœåŠ¡é›†ç¾¤é«˜å¯ç”¨ï¼Œèƒ½å¿«é€Ÿæ‰©å®¹ä»¥åº”å¯¹å¼•æµæ´»åŠ¨é«˜å³°çš„æƒ…å†µ
 	4. èƒ½è¿½æº¯ç”¨æˆ·é“¾æ¡å˜æ›´çš„ç”Ÿå‘½å‘¨æœŸæ—¥å¿—

 é¡¹ç›®åŸºäºä»¥ä¸‹æŠ€æœ¯æ ˆå¼€å‘:
 	1. springboot+jpa
	2. kafkaæœåŠ¡
 	3. redisæœåŠ¡+redisson
	3. mysql8.0(ä½œé€’å½’æŸ¥è¯¢å®Œæ•´é‚€è¯·é“¾æ¡)
	4. è‡ªç ”äº‹ä»¶å‘å¸ƒè®¢é˜…ä¸­é—´ä»¶
	5. è‡ªç ”åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦ä¸­é—´ä»¶
	
 è‡ªç ”éƒ¨åˆ†ä¸»è¦ç›®çš„æœ‰:
	1. æœåŠ¡è‡ªèº«å†…éƒ¨ä¾¿æ”¯æŒé›†ç¾¤ç¯å¢ƒéœ€è¦çš„åŠŸèƒ½ï¼Œå°½é‡å‡å°‘æ¶æ„è½åœ°æ‰€ä¾èµ–éƒ¨ç½²çš„é¢å¤–å…¬å…±æœåŠ¡æ•°é‡
	2. éš”ç¦»ä¾èµ–å…¬ç”¨æœåŠ¡(æ¶ˆæ¯é˜Ÿåˆ—ï¼Œzk)çš„ä¸åŒç³»ç»Ÿä¹‹é—´å¸¦æ¥çš„çº§è”æ€§èƒ½å½±å“ï¼Œåšåˆ°å½“å‰æœåŠ¡é›†ç¾¤å†…éƒ¨ç¯å¢ƒçš„é—­åˆ
	3. ç®€åŒ–å¼•å…¥äº‹ä»¶å‘å¸ƒè®¢é˜…/åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦ç­‰æ¡†æ¶å¸¦æ¥çš„ä¸šåŠ¡å…¥ä¾µï¼Œä»¥ä¸€ç§æœ€ç®€åŒ–çš„æ–¹å¼å¼•å…¥æ¡†æ¶åŠŸèƒ½(springbootç¼–ç¨‹ä¹ æƒ¯)
	4. ä»¥å¤šæœºåˆ†ç‰‡+ä¸»ä»å†—ä½™çš„æ–¹å¼é‡å†™æ¡†æ¶åŠŸèƒ½ï¼Œä¿è¯æ¡†æ¶åŠŸèƒ½åœ¨æœåŠ¡é›†ç¾¤å†…éƒ¨çš„é«˜å¯ç”¨

```
[@seeç»“æ„è¯´æ˜ç¤ºä¾‹é¡¹ç›®](https://gitee.com/Rezar/springboot-ddd-framework/tree/main/ddd-akka-event-publisher-demo)
---
# ä¸€ã€DDDè®¾è®¡æµç¨‹
## 1. è®¾è®¡æµç¨‹

é¢†åŸŸé©±åŠ¨è®¾è®¡è¿™ä¸€æ¦‚å¿µï¼Œå¯ä»¥ä»ä»¥ä¸‹ä¸¤ç‚¹æ¥ç†è§£
1. ç”±ä¸šåŠ¡æ¶‰åŠçš„é¢†åŸŸçŸ¥è¯†é©±åŠ¨ä¸šåŠ¡ç³»ç»Ÿçš„è®¾è®¡
2. ç”±ä¸šåŠ¡ç³»ç»Ÿäº§ç”Ÿçš„è¡Œä¸ºå˜æ›´é€šçŸ¥é©±åŠ¨ä¸åŒä¸šåŠ¡ç³»ç»Ÿå®Œæˆè‡ªèº«çš„ä¸šåŠ¡é€»è¾‘

åœ¨æˆ˜ç•¥è®¾è®¡é˜¶æ®µï¼Œå¼ºè°ƒçš„æ˜¯é«˜åº¦çš„æŠ½è±¡ï¼Œæ— éœ€å…³å¿ƒåº•å±‚ä»£ç çš„å…·ä½“å®ç°åŠæŠ€æœ¯é€‰å‹ï¼Œå…ˆä»¥ä¸€ç§äº§ç ”æµ‹éƒ½èƒ½ç†è§£çš„å›¾ç¤ºæ ‡æ³¨æ–¹å¼è¡¨è¾¾å‡ºç°å®ä¸šåŠ¡ç³»ç»ŸåŒ…å«çš„é¢†åŸŸæ¦‚å¿µï¼Œé¢†åŸŸæ¦‚å¿µåŒ…å«çš„ä¿¡æ¯ï¼Œè¡Œä¸ºä»¥åŠè¡Œä¸ºå‘ç”Ÿåå¯èƒ½éœ€è¦é©±åŠ¨çš„åç»­æ“ä½œã€‚é€šè¿‡è¯†åˆ«å‡ºå®Œå–„çš„ä¸šåŠ¡é¢†åŸŸä¸­çš„å°ç²’åº¦çš„é¢†åŸŸæ¦‚å¿µå¹¶ç»„ç»‡ä»–ä»¬çš„å…³ç³»æ¥å®Œæˆæœ€ç»ˆè®¾è®¡ã€‚
åç»­ä¾¿æ˜¯åŸºäºDDDçš„æˆ˜æœ¯è®¾è®¡è¦æ±‚ï¼Œå…ˆè®¾è®¡å‡ºå°ç²’åº¦é¢†åŸŸæ¦‚å¿µåŒ…å«çš„èšåˆï¼Œå®ä½“ï¼Œå€¼å¯¹è±¡ï¼Œäº‹ä»¶ç­‰æˆå‘˜ç±»ï¼Œè¿™é‡Œå¼ºè°ƒçš„æ˜¯ã€é¢å‘å¯¹è±¡è®¾è®¡ã€‘ï¼Œã€è‡ªé¡¶å‘ä¸‹çš„å¼€å‘æ–¹å‘ã€‘ï¼Œã€é«˜åº¦å†…èšã€‘è¿™å‡ ä¸ªåŸåˆ™ï¼Œç»éªŒä¸Šæ¥è¯´åŒ…å«

```java
1. ä½¿ç”¨å€¼å¯¹è±¡å°è£…æ ‡è¯†ç±»å±æ€§(ä¸šåŠ¡ä¸»é”®æˆ–è€…å…¶ä½™é¢†åŸŸæ¦‚å¿µå®ä½“çš„ID)ï¼Œå¦‚å…¬å¸ID(å°è£…å‡ºCompanyId)ï¼Œèµ‹äºˆå±æ€§æ˜ç¡®çš„é¢†åŸŸç±»å‹

2. å°è£…æœ‰[æ•°æ®å˜æ›´åŸå­æ€§]è¦æ±‚çš„ä¸€æ‰¹å…³è”å±æ€§åˆ°å•ä¸€å€¼å¯¹è±¡ä¸­

3. ä½¿ç”¨æšä¸¾ç±»ç±»å‹çš„å€¼å¯¹è±¡æ¥è¡¨å¾å„ç±»çŠ¶æ€

4. éå¿…è¦çš„æƒ…å†µä¸‹å¿½ç•¥æ•°æ®åº“ä¸€å¯¹å¤šå¤šå¯¹å¤šçš„èŒƒå¼è®¾è®¡è¦æ±‚ï¼Œä»¥é›†åˆç±»å‹å­˜å‚¨å®ä½“æ‰€å¿…è¦çš„ç»“æ„åŒ–ä¿¡æ¯

5. ä¸°å¯Œå®ä½“çš„ä¸šåŠ¡è¡Œä¸ºï¼Œå°†å˜æ›´ä¸šåŠ¡çš„æ“ä½œå…¥å£æ§åˆ¶åœ¨å®ä½“å†…éƒ¨ï¼Œå¯¹å¤–å±è”½æ“ä½œç»†èŠ‚

6. ä¸°å¯Œå®ä½“çš„é€šçŸ¥äº‹ä»¶ç±»å‹ï¼Œç”¨äºäº‹ä»¶å›æº¯å®ä½“ç”Ÿå‘½å‘¨æœŸåŠåç»­é©±åŠ¨å…¶ä»–ä¸šåŠ¡æµç¨‹

7. æŠ½ç¦»å•ä¸€èŒè´£çš„ä¾èµ–å¤–éƒ¨ä¿¡æ¯çš„æ¥å£ç”¨äºè§£è€¦

8. å¿…è¦æƒ…å†µä¸‹å®ç°ã€é¢†åŸŸæœåŠ¡ã€‘ç”¨äºç¼–æ’èšåˆæ“ä½œå’Œé˜²æ­¢å¤–éƒ¨è¾“å…¥å¸¦æ¥çš„è…èš€
```
æœ€ç»ˆå¯¹å¤–å±‚æä¾›æœåŠ¡çš„æ˜¯èšåˆè¿™ä¸€æ¦‚å¿µï¼ŒåŒ…å«ä¸°å¯Œçš„ä¸šåŠ¡å±æ€§ä¿¡æ¯ä»¥åŠå®Œå–„çš„ä¸šåŠ¡è¡Œä¸ºï¼Œå¹¶èƒ½é€šè¿‡è°ƒç”¨è¡Œä¸ºå¼•èµ·èšåˆçŠ¶æ€å˜æ›´å¯¹å¤–å‘å‡ºäº‹ä»¶é€šçŸ¥ã€‚

[èšåˆè¾¹ç•Œåˆ’åˆ†çš„æŒ‡å¯¼åŸåˆ™æœ‰](https://blog.csdn.net/u012179540/article/details/115152804):

```java
1. ç”Ÿå‘½å‘¨æœŸä¸€è‡´(èšåˆå†…éƒ¨çš„å¯¹è±¡ï¼Œåº”è¯¥å’Œèšåˆæ ¹å…·æœ‰ç›¸åŒçš„ç”Ÿå‘½å‘¨æœŸï¼Œèšåˆæ ¹æ¶ˆå¤±ï¼Œåˆ™èšåˆå†…éƒ¨çš„æ‰€æœ‰å¯¹è±¡éƒ½åº”è¯¥ä¸€èµ·æ¶ˆå¤±)

2. é—®é¢˜åŸŸä¸€è‡´(ä¸åº”è¯¥åŒ…å«è„±ç¦»å½“å‰é¢†åŸŸæ¨¡å‹è¿˜èƒ½å­˜åœ¨çš„å¯¹è±¡)

3. æ“ä½œåœºæ™¯ä¸€è‡´(å¯¹è±¡æ“ä½œé¢‘ç‡çš„ä¸€è‡´æ€§)

4. é€‚å½“çš„èšåˆå¤§å°
```

## 2. å¾®æœåŠ¡æ¶æ„

### 2.1 å¾®æœåŠ¡é—´æ¶æ„
åŸºäºè¯»å†™åˆ†ç¦»åŸåˆ™ï¼Œé‚€è¯·é“¾æ¡è®¡ç®—è¿‡ç¨‹(è®¡ç®—èµ„æºæ¶ˆè€—å¤§)å’Œé“¾æ¡æŸ¥è¯¢(è¯»æ“ä½œé¢‘ç¹)åšæœåŠ¡åˆ†ç¦»ï¼Œä»¥å¾®æœåŠ¡å•ä½“é—´äº‹ä»¶åŒæ­¥çš„æ–¹å¼åŒæ­¥æ•°æ®ï¼Œåº•å±‚é‡‡ç”¨ä¸åŒçš„æ•°æ®åº“å®ä¾‹ä¿è¯å„è‡ªçš„è¯»å†™æ€§èƒ½ï¼Œéš”ç¦»ä¸šåŠ¡ä¹‹é—´æ€§èƒ½å·®å¼‚å¸¦æ¥çš„ç›¸äº’å½±å“ã€‚
å³æ‹†åˆ†ä¸º:
	1. invitation_relationship_calc(è®¡ç®—é¡¹ç›®)
	2. invitation_relationship_query(æŸ¥è¯¢é¡¹ç›®)

ä¸¤ä¸ªä¸åŒç³»ç»Ÿï¼Œåˆ†åˆ«å¤šå®ä¾‹éƒ¨ç½²æä¾›æœåŠ¡

invitation_relationship_calcé¡¹ç›®é€šè¿‡apiæ¥å£ä¸ŠæŠ¥ï¼Œå…¶ä½™ç³»ç»Ÿæ¨é€åˆ°æ¶ˆæ¯é˜Ÿåˆ—æ¶ˆè´¹çš„æ•°æ®ä½œä¸ºæ•°æ®è¾“å…¥æ¥æºï¼Œè¾“å‡ºä¸åŒæ¥æºèšåˆåã€å”¯ä¸€ç”¨æˆ·ã€‘çš„é‚€è¯·é“¾å½’å±å…³ç³»ã€‚

invitation_relationship_queryé¡¹ç›®è¾“å…¥é‚€è¯·é“¾å½’å±å…³ç³»ï¼Œè®¡ç®—å‘˜å·¥ã€å¼•æµæŠ¥è¡¨ã€‘ï¼Œã€å¼•æµå•†å“è®¢å•å½’å±ã€‘ç­‰åŸºç¡€æŸ¥è¯¢æ•°æ®ã€‚

### 2.2 å¾®æœåŠ¡å†…åˆ†å±‚
DDDå››å±‚æ¶æ„ç»“æ„:
1. ç”¨æˆ·æ¥å£å±‚(api-å‰ç«¯é€‚é…å…¥å£)
2. åº”ç”¨å±‚(applications-èšåˆçš„äº‹åŠ¡æ€§æ“ä½œï¼Œä¸šåŠ¡ç¼–æ’ç­‰)
3. æ ¸å¿ƒé¢†åŸŸå±‚(domain-æ ¸å¿ƒä¸šåŠ¡æ“ä½œ)
4. åŸºç¡€è®¾æ–½å±‚(infa-äº‹ä»¶ç›‘å¬/æ•°æ®åº“/ç½‘å…³/æ¡†æ¶é…ç½®/è§£è€¦ç±»æ¥å£å®ç°/ä»»åŠ¡è°ƒåº¦ç­‰å„ç±»åŸºç¡€ä¾èµ–)

é¡¹ç›®åŒ…ç»“æ„ç»„ç»‡å…³ç³»:
![é¡¹ç›®åŒ…ç»“æ„ç»„ç»‡å…³ç³»](https://img-blog.csdnimg.cn/932bf4a68eb94b82aa5dfeb00276b71e.png)
## 3. èšåˆè®¾è®¡å’Œä¸šåŠ¡æµç¨‹ç¼–æ’
	å¼•æµå‘˜å·¥åœ¨ä¸åŒå¼•æµæ¥æºä¸‹è¿›è¡Œå¼•æµæ“ä½œï¼Œå¦‚å¾®ä¿¡ç¯å¢ƒå‘å¸ƒé‚€è¯·é“¾æ¥ï¼Œåˆ†äº«å°ç¨‹åºå¡ç‰‡ï¼ŒåŸ‹ç‚¹è¡Œä¸ºä¸ŠæŠ¥ï¼›ç¾¤èŠç¯å¢ƒæ‹‰ç›®æ ‡ç”¨æˆ·å…¥ç¾¤ç­‰æ“ä½œã€‚
	å¾®ä¿¡ç¯å¢ƒåŒ…å«ç”¨æˆ·çš„unionidæ ‡è¯†ï¼Œç¾¤èŠç¯å¢ƒåŒ…å«ç”¨æˆ·çš„ç¾¤æˆå‘˜IDæ ‡è¯†ï¼Œå…¶ä½™ä¾¿æ˜¯ç”¨æˆ·éƒ½åŒ…å«çš„
	ã€æ˜µç§°ã€‘ã€å¤´åƒã€‘ã€ä½ç½®ã€‘ã€çˆ¶é‚€è¯·äººunionId/ç¾¤æˆå‘˜IDã€‘ã€è¢«é‚€è¯·æ—¶é—´ã€‘ç­‰ä¿¡æ¯ã€‚
	
	æˆ‘ä»¬çš„ç›®çš„æ˜¯è¯†åˆ«å‡ºä¸åŒæ¥æºä¸‹æ˜¯åŒä¸€ä¸ªäººçš„ç”¨æˆ·ï¼Œå¹¶æ ¹æ®ä¸åŒæ¥æºä¸‹è¢«çˆ¶çº§é‚€è¯·çš„æ—¶é—´å…ˆåç¡®å®šè¯¥ç”¨æˆ·å‡†ç¡®çš„æœ€æ—©å¼•æµå‘˜å·¥ã€‚
	å¹¶ä¸”åœ¨å½“å‰ç”¨æˆ·çš„æœ€æ—©é‚€è¯·å‘˜å·¥å‘ç”Ÿå˜åŒ–æ—¶ï¼Œéœ€è¦å®æ—¶æ›´æ–°å½“å‰ç”¨æˆ·ä»¥åŠè¢«å½“å‰ç”¨æˆ·é‚€è¯·çš„ä¸‹çº§ç”¨æˆ·é“¾æ¡é‡Œæ‰€æœ‰äººçš„å½’å±å‘˜å·¥ä¿¡æ¯ã€‚
	æœ€åå®æ—¶åŒæ­¥åˆ°å…¶ä»–ä¾èµ–è¿™ä¸ªåŸºç¡€æ•°æ®çš„ç³»ç»Ÿé‡Œç”¨äºæŸ¥è¯¢è®¡ç®—ã€‚
	
	é¢„è®¾ä¸šåŠ¡æ€§èƒ½åœºæ™¯:
		1. æ™®é€šå¾®ä¿¡ç¯å¢ƒçš„ç”¨æˆ·è®¿é—®åœ¨å¼•æµæ´»åŠ¨é«˜å³°æ—¶æœŸQPSå¯èƒ½åœ¨å‡ åƒåˆ°å‡ ä¸‡çš„é‡çº§
		2. ç¾¤èŠç”¨æˆ·æ•°é‡åœ¨å‡ åƒåˆ°å‡ ä¸‡çš„é‡çº§ï¼Œä¸”å®æ—¶æ–°å…¥ç¾¤ç”¨æˆ·QPSåœ¨å‡ ç™¾åˆ°å‡ åƒçš„é‡çº§
		3. å®æ—¶é‚€è¯·é“¾æ¡è®¡ç®—å‡ºçš„å¼•æµå½’å±å‘˜å·¥ä¿¡æ¯çš„æŸ¥è¯¢QPSåœ¨åƒçº§åˆ«

ä»ä¸šåŠ¡æè¿°ä¸­æˆ‘ä»¬å¯ä»¥å¤§è‡´è¯†åˆ«å‡º:
```haskell
1. ä¸åŒæ¥æºä¸‹çš„ç”¨æˆ·æ¦‚å¿µ
	1. æ™®é€šå¾®ä¿¡ç¯å¢ƒ
	2. ç¾¤èŠç¯å¢ƒ
2. åˆå¹¶ä¸åŒæ¥æºç”¨æˆ·ä¿¡æ¯çš„æ¦‚å¿µ
3. ç¾¤èŠç›¸å…³ä¿¡æ¯æ¦‚å¿µ
4. å‘èµ·å¼•æµæ´»åŠ¨çš„å‘˜å·¥æ¦‚å¿µ
```
åŸºäºæ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å¤§ç•¥ç»„ç»‡å‡ºèšåˆåŒ…å«çš„ä¿¡æ¯ï¼Œä½†åœ¨ç»§ç»­è®¾è®¡è¯¦ç»†èšåˆå†…éƒ¨ç»“æ„ä¹‹å‰ï¼Œéœ€è¦è€ƒè™‘æœ€å¼€å§‹æåˆ°çš„é«˜æ€§èƒ½å’Œé«˜å³°å¤„ç½®èƒ½åŠ›ï¼Œå³ä»¥ä¸‹ä¸¤ä¸ªæ€è€ƒé—®é¢˜:

	1. å¦‚ä½•é¿å…å•ä¸€æ•°æ®çš„å¹¶å‘ä¿®æ”¹å†²çª?
	2. å¦‚ä½•åšåˆ°é«˜æ€§èƒ½ä¸”å®æ—¶æ„å»ºæ¯ä¸ªç”¨æˆ·æ‰€å±çš„é‚€è¯·é“¾æ¡?

å¯ä»¥é¢„æƒ³åˆ°çš„æ˜¯ï¼Œé«˜å³°æ—¶æœŸï¼ŒåŒä¸€ä¸ªæ¥æºä¸‹ç”¨æˆ·å¯èƒ½è¢«ä¸åŒçš„çˆ¶é‚€è¯·äººé‚€è¯·ï¼ŒåŒæ—¶ç¾¤èŠé‡ŒåŒä¸€ç”¨æˆ·ä¼šè¢«ä¸åŒçš„çˆ¶é‚€è¯·äººæ‹‰è¿›ç¾¤èŠã€‚çˆ¶é‚€è¯·äººè‡ªèº«çš„é‚€è¯·å…³ç³»ä¹Ÿä¼šå®æ—¶å˜åŠ¨ã€‚æ­¤æ—¶ï¼Œå•ä¸€æ¥æºä¸‹ç”¨æˆ·æ•°æ®çš„å¹¶å‘ä¿®æ”¹ï¼Œç”±ä¸åŒæ¥æºåˆå¹¶å‡ºçš„ã€å”¯ä¸€ç”¨æˆ·ã€‘æ•°æ®çš„å¹¶å‘ä¿®æ”¹ï¼Œã€å”¯ä¸€ç”¨æˆ·ã€‘å‚ä¸çš„é‚€è¯·é“¾æ¡çš„å½’å±å‘˜å·¥çš„è®¡ç®—å’Œè®¡ç®—ç»“æœçš„æ›´æ–°å¯¼è‡´çš„æ•°æ®å¹¶å‘ä¿®æ”¹ç­‰æƒ…å†µä¼šéå¸¸é¢‘ç¹ã€‚

å®¹æ˜“æƒ³åˆ°çš„è§£å†³æ–¹æ¡ˆæ˜¯ï¼Œæ•°æ®å¹¶å‘ä¿®æ”¹è¿™ä¸€å—ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ•°æ®åº“äº‹åŠ¡é”ï¼Œåˆ†å¸ƒå¼é”ç­‰æ–¹å¼æ§åˆ¶å¹¶å‘ä¿®æ”¹ï¼›åŸºäºå„ç§é•¿æœŸä»»åŠ¡è¯»å–å¿«ç…§æ•°æ®è¿›è¡Œæ»åæ€§è®¡ç®—å®Œæˆä¸åŒæ¥æºç”¨æˆ·è¯†åˆ«ä¸ºã€å”¯ä¸€ç”¨æˆ·ã€‘çš„åˆå¹¶è¿‡ç¨‹å’Œè®¡ç®—æ‰€æœ‰ã€å”¯ä¸€ç”¨æˆ·ã€‘çš„é‚€è¯·é“¾æ¡ï¼›

ä½†è¿™æ ·çš„æ–¹æ¡ˆæ— æ³•åšåˆ°å®æ—¶ä»¥åŠè‰¯å¥½çš„æ€§èƒ½ï¼Œæ•°æ®åº“äº‹åŠ¡é”æœ‰å†²çªå’Œæ­»é”çš„å¯èƒ½ï¼Œå¹¶ä¸”å¾ˆå¯èƒ½å¯¹æ•°æ®åº“é€ æˆæ€§èƒ½å‹åŠ›ï¼›åˆå¹¶ä¸åŒæ¥æºç”¨æˆ·/è®¡ç®—é‚€è¯·é“¾æ¡å½’å±éœ€è¦åŠ è½½å…¨é‡æ•°æ®ï¼Œè®¡ç®—è¿‡ç¨‹ä¸­å†…å­˜èµ„æºæ¶ˆè€—å¤§ä¸”æ— æ³•è¿›è¡Œä»»åŠ¡æ•°æ®åˆ†æ²»ä»¥å¤šæœºæ‰§è¡Œåˆ†æ‹…å‹åŠ›ï¼›æ— æ³•ç»™å…¶ä»–ä¸šåŠ¡æä¾›å‡†å®æ—¶è®¡ç®—ç»“æœã€‚

æ­¤æ—¶æŒ‰ç…§DDDçš„æŒ‡å¯¼æ€æƒ³æˆ‘ä»¬å¯ä»¥é€šè¿‡ã€å“åº”å®æ—¶æ•°æ®çš„å˜æ›´ã€‘ã€æ’é˜Ÿå¯¹å•ä¸€æ•°æ®çš„å¹¶å‘ä¿®æ”¹è¯·æ±‚ã€‘ã€é¿å…å¯¹æ•°æ®è¿›è¡Œé‡é‡çº§åŠ é”æ“ä½œï¼Œå¹¶å…è®¸åœ¨æ•°æ®å†²çªå‘ç”Ÿåæœ‰é™æ¬¡æ•°é‡è¯•ä¿®æ”¹æ“ä½œã€‘ç­‰æ–¹å¼æ¥é™ä½æ•°æ®å†²çªé£é™©å’ŒåŠ é€Ÿæ•°æ®çš„å¤„ç†è¿‡ç¨‹ã€‚

è½åœ°æ–¹æ¡ˆæ— å¤–ä¹ä»¥ä¸‹å‡ ç§:
	
	1. è¯†åˆ«å¹¶éš”ç¦»ä¸åŒä¸šåŠ¡é¢†åŸŸçš„æ•°æ®å…³è”
	2. åœ¨æ•°æ®ä¿®æ”¹å†²çªè¾ƒä½çš„æƒ…å†µä¸‹ä½¿ç”¨ä¹è§‚é”æ–¹å¼ï¼Œé‡è¯•å¤±è´¥æ“ä½œ
	3. ä»»ä½•èšåˆå†…éƒ¨çŠ¶æ€å‘ç”Ÿå˜åŒ–ï¼Œå®æ—¶å‘å¸ƒå¿…è¦çš„å˜æ›´äº‹ä»¶ç”¨ä»¥é©±åŠ¨å…¶ä»–ä¸šåŠ¡æµç¨‹çš„è¿›è¡Œ
	4. å°†å¯¹åŒä¸€æ•°æ®çš„ä¿®æ”¹è¯·æ±‚åˆ†ç‰‡åˆ°å•ä¸€æ“ä½œé˜Ÿåˆ—ä¸­(å¸¦æœ‰åˆ†åŒºå‘å¸ƒçš„æ¶ˆæ¯é˜Ÿåˆ—/CQRS+EventSourceæ¨¡å¼)ï¼Œä¸åŒæ•°æ®çš„æ“ä½œé˜Ÿåˆ—ç”±å¯æ‰©å±•çš„èŠ‚ç‚¹å¹¶è¡Œå¤„ç†

è¿™é‡Œä»¥å…·ä½“æµç¨‹ç¤ºä¾‹æ¥è¯´æ˜ä¸Šé¢æ€è€ƒé—®é¢˜åæ˜ çš„å®é™…æƒ…å†µå’Œå¯¹åº”çš„è§£å†³æ–¹æ¡ˆ
### 3.1. å•æ¥æºä¸‹ç”¨æˆ·ä¿¡æ¯çš„å¤„ç†æµç¨‹
åŸºäºä¸šåŠ¡æè¿°å¯ä»¥è¯†åˆ«å‡ºã€æ™®é€šå¾®ä¿¡ç¯å¢ƒä¸‹å¸¦unionidçš„ç”¨æˆ·ã€‘ã€ç¾¤èŠç¯å¢ƒä¸‹å¸¦ç¾¤æˆå‘˜IDçš„ç”¨æˆ·ã€‘ä¸¤ä¸ªæ¦‚å¿µï¼Œé™¤äº†æ ‡è¯†IDä¸ä¸€è‡´å¤–ï¼Œå…¶ä½™ä¿¡æ¯å­—æ®µéƒ½ä¿æŒä¸€è‡´ï¼Œæˆ‘ä»¬å¯ä»¥æŠ½è±¡å‡ºã€è®¿é—®ç”¨æˆ·ã€‘è¿™ä¸€é¢†åŸŸæ¨¡å‹ï¼Œè€Œé€šè¿‡ä¸Šé¢å¯¹è§£å†³æ–¹æ¡ˆçš„è®¨è®ºï¼Œæˆ‘ä»¬é¦–å…ˆå¯ä»¥é€šè¿‡ã€æ•°æ®åº“ä¹è§‚é”ã€‘çš„æ–¹å¼æ¥å¤„ç†å•ä¸€ã€è®¿é—®ç”¨æˆ·ã€‘çš„æ•°æ®å˜æ›´æ“ä½œï¼›æ¥ä¸‹æ¥æ€è€ƒã€è®¿é—®ç”¨æˆ·ã€‘å’Œå…¶ä»–é¢†åŸŸæ¨¡å‹çš„è”ç³»ï¼Œæˆ‘ä»¬æœ€ç»ˆç›®çš„æ˜¯åŸºäºåŸºç¡€ä¿¡æ¯åˆå¹¶ä¸åŒæ¥æºä¸‹çš„ã€è®¿é—®ç”¨æˆ·ã€‘ä¸ºã€å”¯ä¸€ç”¨æˆ·ã€‘ï¼Œå¹¶è®¡ç®—ã€å”¯ä¸€ç”¨æˆ·ã€‘çš„æœ€æ—©é‚€è¯·å…³ç³»ã€‚æ‰€ä»¥æˆ‘ä»¬è®©ã€è®¿é—®ç”¨æˆ·ã€‘åœ¨ã€ã€æ˜µç§°ã€‘ã€å¤´åƒã€‘ã€åœ°åŸŸã€‘ã€‘ç­‰ä¿¡æ¯å‘ç”Ÿå˜åŒ–çš„æ—¶å€™å‘å¸ƒå˜æ›´äº‹ä»¶å‡ºå»ï¼Œç”¨äºé©±åŠ¨ã€å”¯ä¸€ç”¨æˆ·ã€‘é¢†åŸŸæ¨¡å‹æŒ‰è§„åˆ™å¯»æ‰¾å¾…åˆå¹¶çš„å…¶ä»–æ¥æºä¸‹çš„ã€è®¿é—®ç”¨æˆ·ã€‘å¹¶è¿›è¡Œæ•°æ®åˆå¹¶ã€‚è®©ã€è®¿é—®ç”¨æˆ·ã€‘å†…éƒ¨ä¿å­˜æœ€æ—©çˆ¶é‚€è¯·äººä¿¡æ¯ï¼Œå¹¶å½“æœ€æ—©çˆ¶é‚€è¯·äººä¿¡æ¯å‘ç”Ÿå˜åŒ–çš„æ—¶å€™ï¼Œå‘å¸ƒå˜æ›´äº‹ä»¶å‡ºå»ï¼Œç”¨äºé©±åŠ¨ã€å”¯ä¸€ç”¨æˆ·ã€‘é¢†åŸŸæ¨¡å‹æ¯”è¾ƒæ›´æ–°å¤šæ¥æºé‡ŒçœŸæ­£çš„æœ€æ—©çˆ¶é‚€è¯·äººä¿¡æ¯ã€‚

è‡³æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥è®¾è®¡å‡ºä»¥ä¸‹ã€è®¿é—®ç”¨æˆ·ã€‘çš„èšåˆå†…éƒ¨ç»“æ„:
```haskell
1. ç”¨æˆ·æ¥æºåŒ…å«å¾®ä¿¡ç¯å¢ƒå’Œç¾¤èŠç¯å¢ƒï¼Œå°†ã€ç¯å¢ƒç±»å‹ã€‘å’Œã€æ ‡è¯†IDã€‘äºŒå…ƒæ•°æ®æ„å»ºä¸ºå•ä¸€å€¼å¯¹è±¡ä½œä¸ºä¸»é”®æ ‡è¯†(VisitorId)
2. ç”¨æˆ·ã€æ˜µç§°ã€‘ï¼Œã€å¤´åƒã€‘ï¼Œã€åœ°åŸŸã€‘ï¼Œã€æ›´æ–°æ—¶é—´ã€‘å¤šå…ƒæ•°æ®éœ€è¦è¢«æ•´ä½“è¯»å†™ï¼Œè®¾è®¡ä¸ºå€¼å¯¹è±¡(VisitorProfile)
3. ç”¨æˆ·å½“å‰æœ€æ—©ã€é‚€è¯·äººIDã€‘ã€é‚€è¯·æ—¶é—´ã€‘äºŒå…ƒæ•°æ®éœ€è¦è¢«æ•´ä½“è¯»å†™ï¼Œè®¾è®¡ä¸ºå€¼å¯¹è±¡(VisitorFirstInviteBy)
4. VisitorProfileåŸºäºã€æ›´æ–°æ—¶é—´ã€‘åˆ¤æ–­æ˜¯å¦éœ€è¦æ›´æ–°ï¼Œæ›´æ–°åå‘å¸ƒç”¨æˆ·åŸºç¡€ä¿¡æ¯å˜æ›´çš„é¢†åŸŸäº‹ä»¶
5. VisitorFirstInviteByåŸºäºã€é‚€è¯·æ—¶é—´ã€‘å…ˆååˆ¤æ–­æ˜¯å¦éœ€è¦æ›´æ–°ï¼Œæ›´æ–°åå‘å¸ƒç”¨æˆ·æœ€æ—©é‚€è¯·äººå˜æ›´çš„é¢†åŸŸäº‹ä»¶
```
ç¤ºä¾‹ä»£ç å¦‚ä¸‹:

```java
@Data
@Entity
@DynamicUpdate
@NoArgsConstructor
@AllArgsConstructor
@ToString(callSuper = true)
@EqualsAndHashCode(callSuper = true)
@Table(
        name = "visitor_user",
        uniqueConstraints = {
        		@UniqueConstraint(columnNames = { "taskId", "visitorId" })},
        indexes = {
        		@Index(columnList = "taskId,nickName")})
public class Visitor extends IdentifiedEntity {
	
	private InviteTaskId taskId;
	private VisitorId visitorId;
	private VisitorProfile profile;
	// è®¿å®¢çš„æœ€æ—©é‚€è¯·è®°å½•
	private VisitorInviteBy visitorInviteBy;
	
	public Visitor(
			InviteTaskId taskId,
			VisitorId visitorId,
			VisitorProfile profile) {
		this.taskId = taskId;
		this.visitorId = visitorId;
		this.tryModifyVisitorProfile(profile);
		DomainEventPublisher.publish(
				new NewVisitor(
						this.taskId,
						this.visitorId,
						this.profile));
	}
	
	/**
	 * æ›´æ–°é‚€è¯·è®°å½•
	 * 
	 * @param visitorInviteBy
	 */
	public void newInvitation(
			VisitorInviteBy visitorInviteBy) {
		// è‡ªèº«é‚€è¯·ï¼Œå¿½ç•¥
		// å¦‚æœä¹‹å‰æ²¡æœ‰çˆ¶é‚€è¯·äººï¼Œä½†ç°åœ¨æœ‰äº†æ¡æœ€æ—©é‚€è¯·æ¯”å½“å‰è®°å½•åˆ›å»ºæ—¶é—´æ›´æ—©çš„é‚€è¯·è®°å½•ï¼Œå¿½ç•¥(é¿å…å¾ªç¯é‚€è¯·)
		if (this.isSelfInvite(visitorInviteBy)
				|| visitorInviteBy.getVisitTime().isAfter(this.createdAt())
				|| visitorInviteBy.equals(this.visitorInviteBy)) {
			return;
		}
		if (this.visitorInviteBy == null
				|| this.visitorInviteBy.getVisitTime().isAfter(
						visitorInviteBy.getVisitTime())) {
			this.visitorInviteBy = visitorInviteBy;
			// å‘å¸ƒç”¨æˆ·æœ€æ—©é‚€è¯·äººå˜æ›´çš„é¢†åŸŸäº‹ä»¶
			DomainEventPublisher.publish(
					new VisitorInviteByChanged(
							this.taskId,
							this.visitorId,
							visitorInviteBy,
							this.visitorNickName()));
		}
	}

	public void tryModifyVisitorProfile(
			VisitorProfile profile) {
		// å¿½ç•¥å¤´åƒä¸ºç©ºçš„
		if (profile.imageNotValid()) {
			return;
		}
		if (this.profile == null
				|| (!this.profile.equals(profile) 
						&& this.profile.isOldThan(profile)
						&& this.profile.profileFromWayAcceptUpdate(
								profile.profileFromWay()))) {
			VisitorProfile oldProfile = this.profile;
			this.profile = profile;
			// å‘å¸ƒç”¨æˆ·åŸºç¡€ä¿¡æ¯å˜æ›´çš„é¢†åŸŸäº‹ä»¶
			DomainEventPublisher.publish(
					new VisitorProfileChanged(
							this.taskId,
							this.visitorId,
							this.profile,
							oldProfile));
		}
	}
	
	private String visitorNickName() {
		String nickName = 
				this.profile == null ? 
						"" : this.profile.getNickName();
		return nickName;
	}
	
	private boolean isSelfInvite(
			VisitorInviteBy visitorInviteBy) {
		return visitorInviteBy != null 
				&& this.visitorId.isEquals(visitorInviteBy.getInviterId());
	}
	
	public LocalDateTime createdAt() {
		return this.getCreatedAt().toInstant().atZone(ZoneId.systemDefault()).toLocalDateTime();
	}
}
```
### 3.2. å°ç¨‹åº/å…¬ä¼—å·ç”¨æˆ·è®¿é—®æ•°æ®çš„å¤„ç†æµç¨‹
ä¸šåŠ¡é«˜å³°æ—¶æœŸï¼Œé€šè¿‡å°ç¨‹åºåˆ†äº«å¡ç‰‡ï¼Œè®¿é—®æ´»åŠ¨é¡µé¢åŸ‹ç‚¹ä¸ŠæŠ¥çš„æ•°æ®é‡ä¼šéå¸¸å¤§ã€‚æ•°æ®åŒ…å«ã€é‚€è¯·äººä¿¡æ¯ã€‘ï¼Œã€è¢«é‚€è¯·äººä¿¡æ¯ã€‘ï¼Œã€é‚€è¯·è¯¦æƒ…ã€‘ç­‰ä¿¡æ¯ï¼Œè¿™äº›æ•°æ®ç”¨äºæ„å»ºæ™®é€šå¾®ä¿¡ç¯å¢ƒä¸‹çš„ã€è®¿é—®ç”¨æˆ·ã€‘èšåˆã€‚è‹¥åœ¨è®¿é—®ä¸ŠæŠ¥çš„æ¥å£å¤„ç†æµç¨‹é‡Œè¿›è¡Œã€è®¿é—®ç”¨æˆ·ã€‘ä¿¡æ¯çš„åˆ›å»º/æ¯”è¾ƒæ›´æ–°ç­‰æ“ä½œæ— æ³•æ»¡è¶³ä¸ŠæŠ¥æ¥å£çš„æ€§èƒ½è¦æ±‚ï¼Œä¸ºè§£è€¦ä¸ŠæŠ¥ä¸æ„å»ºã€è®¿é—®ç”¨æˆ·ã€‘ä¸¤ä¸ªæµç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥å°†ä¸ŠæŠ¥æ•°æ®è®¾è®¡ä¸ºã€ä¸ŠæŠ¥æ•°æ®æ—¥å¿—ã€‘é¢†åŸŸæ¨¡å‹ï¼Œæ¨¡å‹å­˜å‚¨æ¯ä¸€æ¬¡ä¸ŠæŠ¥çš„å†…å®¹ï¼Œå¹¶å‘å¸ƒã€æ—¥å¿—åˆ›å»ºã€‘çš„é¢†åŸŸäº‹ä»¶ã€‚

ã€ä¸ŠæŠ¥æ•°æ®æ—¥å¿—ã€‘ä½œä¸ºã€è®¿é—®ç”¨æˆ·ã€‘é¢†åŸŸæ¨¡å‹çš„è¾“å…¥ï¼Œæˆ‘ä»¬éœ€è¦é¿å…å¯¹åŒä¸€unionIdçš„ã€è®¿é—®ç”¨æˆ·ã€‘çš„å¹¶å‘ä¿®æ”¹ï¼Œæ‰€ä»¥æˆ‘ä»¬å¼•å…¥åˆ†åŒºæ¶ˆè´¹çš„æ¦‚å¿µï¼Œå³ä¿è¯æ‰€å±åŒä¸€ã€è¢«é‚€è¯·äººunionIdã€‘çš„ã€æ—¥å¿—åˆ›å»ºã€‘äº‹ä»¶ç”±å•ä¸€æ¶ˆè´¹è€…æ¶ˆè´¹ï¼Œè‡³æ­¤æˆ‘ä»¬å¯ä»¥æ”¾å¿ƒçš„åœ¨æ“ä½œã€è®¿é—®ç”¨æˆ·ã€‘çš„æ•°æ®æ—¶ä½¿ç”¨ä¹è§‚é”æœºåˆ¶ã€‚åŒæ—¶ä¸ŠæŠ¥æµç¨‹ç®€åŒ–ä¸ºå­˜å‚¨ä¸€æ¡æ—¥å¿—è®°å½•ï¼Œå‘å¸ƒé¢†åŸŸäº‹ä»¶ä¸¤ä¸ªæ­¥éª¤ã€‚

æ¶ˆè´¹ç¤ºä¾‹ä»£ç å¦‚ä¸‹:

```java
	@EventSynchronizer(
			partition = 30,
			clientConcurrency = 10)
	@ShardingKeyExpression(
			el ="#event[inviteTaskId] + '-' + #event[wxUnionId]")
	public void handleWxVisitReportLogAndUpdateVisitorUserInfo(
			NewWxVisitReportLog newWxVisitReportLog) {
		this.visitorApp.visitorNewInvation(
				newWxVisitReportLog.getTaskId(), 
				newWxVisitReportLog.getWxUnionId(),
				newWxVisitReportLog.getVisitorProfile(),
				newWxVisitReportLog.getInviterInfo());
	}
```

### 3.3. ç¾¤èŠç¯å¢ƒä¸‹ç”¨æˆ·æ•°æ®çš„å¤„ç†æµç¨‹
å¼•æµæ´»åŠ¨åˆ›å»ºæ—¶ä¼šåŒæ­¥åœ¨ç¬¬ä¸‰æ–¹æœåŠ¡å•†(å¦‚ä¼ä¸šå¾®ä¿¡å¼€æ”¾å¹³å°)é‚£åˆ›å»ºå¯¹åº”çš„ç¾¤æ´»åŠ¨ç”¨äºæ‹‰æ–°ï¼Œåç»­å¼•æµå‘˜å·¥æ‹‰æ–°çš„ç¾¤èŠæˆå‘˜æ•°æ®é€šè¿‡æ¥å£è·å–å›æ¥ï¼Œå•æ¬¡æ¥å£è¯·æ±‚ä¼šåˆ†é¡µè¿”å›å…¨é‡çš„æ´»åŠ¨ä¸‹å…¥ç¾¤çš„ç”¨æˆ·æ•°æ®ã€‚åŒæ ·ç¾¤èŠæˆå‘˜æ•°æ®åŒ…å«ã€ç¾¤æˆå‘˜ä¿¡æ¯ã€‘ï¼Œã€çˆ¶çº§ç¾¤æˆå‘˜ä¿¡æ¯ã€‘ï¼Œã€é‚€è¯·è¯¦æƒ…ã€‘ç­‰ä¿¡æ¯ç”¨äºæ„å»ºç¾¤èŠç¯å¢ƒä¸‹çš„ã€è®¿é—®ç”¨æˆ·ã€‘èšåˆã€‚

è¿™é‡Œä»é¢„è®¾çš„ä¸šåŠ¡æ€§èƒ½åœºæ™¯é‡Œå¯çŸ¥ï¼Œç¾¤æ´»åŠ¨åŒ…å«æ•°é‡ä¼—å¤šçš„å•ä¸ªç¾¤èŠï¼ŒåŒä¸€ä¸ªç”¨æˆ·å¯èƒ½åœ¨ä¸åŒç¾¤èŠé‡Œç”±ä¸åŒçš„äººé‚€è¯·å…¥ç¾¤ï¼Œè€Œä¸”æ•´ä¸ªç¾¤æ´»åŠ¨ä¸‹å…¥ç¾¤æˆå‘˜æ•°é‡åœ¨å‡ ä¸‡çš„é‡çº§ã€‚

æ‰€ä»¥è¿™é‡Œé¢ä¸´çš„é—®é¢˜æœ‰:

	1. ç¾¤èŠæ•°æ®ä»¥å…¨é‡çš„æ–¹å¼è¯·æ±‚ï¼Œè¯·æ±‚æ•°æ®çš„è¿‡ç¨‹å¦‚æœåšåˆ°é«˜æ€§èƒ½?
	2. æ•°æ®æ¥å£ä¸å‘ŠçŸ¥å“ªäº›æ˜¯æ–°åŠ å…¥çš„ç¾¤æˆå‘˜ï¼Œå“ªäº›ç¾¤æˆå‘˜çš„æ˜µç§°ã€å¤´åƒç­‰åŸºç¡€ä¿¡æ¯å‘ç”Ÿäº†å˜åŒ–

æˆ‘ä»¬çš„ç›®çš„æ˜¯å°½å¿«å°†ç¾¤æˆå‘˜ä¿¡æ¯è½¬æ¢ä¸ºã€è®¿é—®ç”¨æˆ·ã€‘çš„çŠ¶æ€ä¿¡æ¯ã€‚
	
æ‰€ä»¥å¯¹äºé—®é¢˜1
	
	æˆ‘ä»¬å¼•å…¥åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦çš„æ¦‚å¿µï¼Œå°†åŒä¸€ç¾¤æ´»åŠ¨çš„åˆ†é¡µæ•°æ®è·å–è¿‡ç¨‹åˆ†æ²»åˆ°å¤šçº¿ç¨‹ä¹ƒè‡³å¤šå®ä¾‹èŠ‚ç‚¹ä¸Šå®Œæˆã€‚
	æ—¢å¯ä»¥åŠ é€Ÿæ•°æ®è·å–çš„è¿‡ç¨‹ï¼Œå‡å°‘å•èŠ‚ç‚¹çš„æ€§èƒ½å‹åŠ›ï¼Œåˆèƒ½å¿«é€Ÿæ¨ªå‘æ‰©å±•ä»»åŠ¡èŠ‚ç‚¹é€‚åº”ä¸šåŠ¡çš„å‘å±•

å¯¹äºé—®é¢˜2
	
	å¦‚æœæˆ‘ä»¬ä¸åŠ åŒºåˆ†çš„å°†æ¯æ¡æˆå‘˜æ•°æ®ä¼ é€’åˆ°æ„å»ºã€è®¿é—®ç”¨æˆ·ã€‘çš„å¤„ç†æµç¨‹ä¸­ï¼Œç›¸å½“äºæ¯ä¸€æ¬¡æ‹‰ç¾¤æ“ä½œä¸­ï¼Œéƒ½éœ€è¦å¯¹å‡ ä¸‡æ¡ã€è®¿é—®ç”¨æˆ·ã€‘çš„è®°å½•
	è¿›è¡Œåˆ›å»ºå’Œæ›´æ–°åˆ¤æ–­æ“ä½œï¼Œæ­¤æ—¶ç”±äºå¼•å…¥äº†æ•°æ®åˆ†æ²»çš„å¹¶è¡Œå¤„ç†è¿‡ç¨‹ï¼ŒåŒä¸€ä¸ªã€ç¾¤æˆå‘˜IDã€‘çš„ã€è®¿é—®ç”¨æˆ·ã€‘åœ¨ä¸åŒçš„ç¾¤èŠé‡Œå¹¶ä¸”ç”±äºä¸åŒç¾¤èŠæ•°æ®
	è¢«ä¸åŒä»»åŠ¡èŠ‚ç‚¹å¤„ç†çš„æƒ…å†µä¸‹ï¼Œå°±å¾ˆå®¹æ˜“å¯¼è‡´å¯¹åŒä¸€ã€è®¿é—®ç”¨æˆ·ã€‘èšåˆçš„å¹¶å‘ä¿®æ”¹æ“ä½œï¼Œè¿›è€Œå½±å“æ‹‰ç¾¤æ“ä½œçš„æ€§èƒ½ã€‚
	æ‰€ä»¥è¿™é‡Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘ç»™ç¾¤æˆå‘˜æ•°æ®æŠ½è±¡å‡ºä¸€ä¸ªã€ç¾¤æˆå‘˜ä¿¡æ¯ã€‘çš„é¢†åŸŸæ¨¡å‹ï¼Œä»¥ã€ã€ç¾¤èŠIDã€‘+ ã€ç¾¤æˆå‘˜IDã€‘ã€‘ä¸ºä¸»é”®æ ‡è¯†ï¼Œå•æ¬¡æ‹‰ç¾¤æ“ä½œä¸­ï¼Œ
	åŸºäºè¿™ä¸ªä¸»é”®è·å–åˆ°å†å²ã€ç¾¤æˆå‘˜ä¿¡æ¯ã€‘ï¼Œå¹¶å’Œæ‹‰å›çš„æœ€æ–°ç¾¤èŠæˆå‘˜ä¿¡æ¯è¿›è¡Œæ¯”è¾ƒåˆ¤æ–­ï¼Œå‘å¸ƒå„ç±»æ›´æ–°é¢†åŸŸäº‹ä»¶åˆ°ã€è®¿å®¢ç”¨æˆ·ã€‘é¢†åŸŸé‡Œï¼Œ
	ã€è®¿å®¢ç”¨æˆ·ã€‘é¢†åŸŸåŸºäºã€ç¾¤æˆå‘˜IDã€‘çš„åˆ†åŒºé”®è¿›è¡Œåˆ†åŒºæ¶ˆè´¹ï¼Œé¿å…äº†ç›´æ¥å¯¹ã€ç¾¤æˆå‘˜IDã€‘æ ‡è¯†çš„ã€è®¿å®¢ç”¨æˆ·ã€‘è¿›è¡Œæ“ä½œå¯¼è‡´çš„æ•°æ®å†²çªã€‚

ä»¥ä¸‹æ˜¯åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦çš„ç¤ºä¾‹ä»£ç :

```java
	@DistributedJob(
			jobShowName = "æ‹‰å–ç¾¤æ´»åŠ¨ç¾¤æˆå‘˜",
			jobExecuteType = JobExecuteType.MAP,
			concurrency = 5,
			jobScheduled = @JobScheduled(cron = "0 * * * * ?", initialDelay = 30000),
			jobScheduleTimeout = 
				@JobScheduleTimeout(
						timeout = 4, 
						timeoutUnit = TimeUnit.MINUTES, 
						timeoutListener = ErrorReportJobScheduleTimeoutBySMSListener.class))
	public TaskResult pullGroupMembers(
			JobTaskContext context) {
		if (context.isRootTask()) {
			// åˆå§‹æ ¹ä»»åŠ¡
			return this.rootMapSubPullTask(TASK_TYPE.SubPullTaskType);
		} else if (context.isTaskOfType(TASK_TYPE.SubPullTaskType.name())) {
			// äºŒçº§å®é™…æ‰§è¡Œçš„ä»»åŠ¡
			PullPageRequest pullPageRequest = 
					context.task(PullPageRequest.class);
			return TaskResult.succ(
					subPullGrupMembersHandler.handle(pullPageRequest));
		}
		return TaskResult.succ();
	}
	
```
å“åº”ã€ç¾¤æˆå‘˜ä¿¡æ¯ã€‘é¢†åŸŸäº‹ä»¶çš„ç¤ºä¾‹ä»£ç :

```java
	@EventSynchronizer(
			partition = 30, 
			clientConcurrency = 10)
	@ShardingKeyExpression(
			el ="#event[taskId] + '-' + #event[wxMemberId]")
	public void groupMemberAsVisitorUser(
			NewGroupMember newGroupMember,
			GroupMemberProfileChanged groupMemberProfileChanged,
			GroupMemberInGroupInfoChanged groupMemberInGroupInfoChanged) {
		if (newGroupMember != null) {
			GroupMemberProfile profile = newGroupMember.getProfile();
			GroupMemberInviterInfo inviter = newGroupMember.inviter();
			this.visitorApplication.visitorNewInvation(
					newGroupMember.getTaskId(),
					newGroupMember.getWxMemberId().asVisitorId(), 
					new VisitorProfile(
							profile.getNickName(), 
							profile.getHeadImageUrl(),
							inviter.getInviteTime()),
					inviter.getInviterWxMemberId().asVisitorId(),
					inviter.getInviteTime());
		} else if (groupMemberProfileChanged != null) {
			GroupMemberProfile profile = 
					groupMemberProfileChanged.getProfile();
			this.visitorApplication.tryUpdateVisitorProfile(
					groupMemberProfileChanged.getTaskId(),
					groupMemberProfileChanged.getWxMemberId().asVisitorId(),
					new VisitorProfile(
							profile.getNickName(), 
							profile.getHeadImageUrl(),
							groupMemberProfileChanged.getProfileUpdatedAt()));
		} else if (groupMemberInGroupInfoChanged != null) {
			GroupMemberInviterInfo inviter = 
					groupMemberInGroupInfoChanged.inviter();
			this.visitorApplication.visitorNewInvation( 
					groupMemberInGroupInfoChanged.getTaskId(), 
					groupMemberInGroupInfoChanged.getWxMemberId().asVisitorId(), 
					inviter.getInviterWxMemberId().asVisitorId(), 
					inviter.getInviteTime());
		}
	}
```
### 3.4. ã€å”¯ä¸€ç”¨æˆ·ã€‘æ¦‚å¿µçš„æ•°æ®å¤„ç†æµç¨‹
ã€å”¯ä¸€ç”¨æˆ·ã€‘æ˜¯æŒ‰ç…§ä¸€å®šçš„åŒ¹é…è§„åˆ™ï¼Œåˆå¹¶ä¸åŒå¼•æµæ¥æºä¸‹ã€è®¿é—®ç”¨æˆ·ã€‘çš„ä¿¡æ¯å¾—åˆ°çš„ï¼Œè¿™ä¸ªé¢†åŸŸæ¨¡å‹è¾ƒä¸ºå¤æ‚ã€‚

1. æˆ‘ä»¬é¦–å…ˆéœ€è¦è€ƒè™‘çš„æ˜¯å¦‚ä½•å®æ—¶åˆå¹¶ä¸åŒæ¥æºçš„ã€è®¿é—®ç”¨æˆ·ã€‘çš„æ•°æ®ï¼Œå¹¶å°½é‡é¿å…æ•°æ®å†²çªçš„æƒ…å†µã€‚åˆå¹¶çš„åŸºç¡€æ˜¯æ˜µç§°ä¸€è‡´ï¼Œå¤´åƒç›¸ä¼¼ç­‰ï¼Œè€Œæ•°æ®æ¥æºåˆ™æ˜¯ä¹‹å‰è®¨è®ºè¿‡çš„ä¸åŒæ¥æºä¸‹ã€è®¿é—®ç”¨æˆ·ã€‘èšåˆçŠ¶æ€å˜æ›´å‘å¸ƒçš„é¢†åŸŸäº‹ä»¶ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¾ˆå®¹æ˜“æƒ³åˆ°ï¼Œä»¥ã€æ˜µç§°ã€‘ä½œä¸ºåˆ†åŒºé”®ï¼Œå°†ç›¸åŒæ˜µç§°çš„ã€è®¿é—®ç”¨æˆ·ã€‘äº§ç”Ÿçš„å˜æ›´äº‹ä»¶äº¤ç”±å•ä¸€æ¶ˆè´¹èŠ‚ç‚¹æ¶ˆè´¹ï¼Œè¿™æ ·å°±èƒ½å¤§å¤§é™ä½ç”¨æˆ·åˆå¹¶è¿‡ç¨‹ä¸­ï¼Œä¸åŒæ¥æºä¸‹çš„ã€è®¿é—®ç”¨æˆ·ã€‘è®°å½•ç›¸äº’å°è¯•åˆå¹¶å¯¹æ–¹å¯¼è‡´çš„æ•°æ®å†²çªé—®é¢˜ã€‚
2. å…¶æ¬¡ä¾¿æ˜¯å½“ã€å”¯ä¸€ç”¨æˆ·ã€‘åœ¨æŸä¸ªæ¥æºä¸‹çš„åŸºç¡€ä¿¡æ¯å‘ç”Ÿå˜åŒ–æ—¶ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦åŸºäºæ›´æ–°åçš„ã€æ˜µç§°ã€‘ã€å¤´åƒã€‘ç­‰åŸºç¡€ä¿¡æ¯ï¼Œé‡è¯•1çš„åˆå¹¶æµç¨‹ï¼Œè¿™é‡Œå°±æ¶‰åŠåˆ°åˆå¹¶æ‹†åˆ†çš„æƒ…å†µã€‚
3. å¤„ç†å®Œåˆå¹¶é€»è¾‘è¯†åˆ«å‡ºã€å”¯ä¸€ç”¨æˆ·ã€‘ä¹‹åï¼Œä¾¿éœ€è¦è€ƒè™‘é‚€è¯·é“¾è®¡ç®—çš„é—®é¢˜ã€‚è¿™ä¸ªåœ°æ–¹çš„éš¾ç‚¹åœ¨äºï¼Œé‚€è¯·é“¾ä¸­çš„æ¯ä¸ªäººéƒ½å¤„äºå®æ—¶å˜åŒ–çš„è¿‡ç¨‹ä¸­ï¼Œæ¯”å¦‚è¯´Aé‚€è¯·äº†Bï¼ŒBé‚€è¯·äº†Cï¼Œæˆ‘ä»¬åœ¨åŸºäºAè®¡ç®—Bï¼ŒCçš„å½’å±å‘˜å·¥æ—¶ï¼Œæœ‰å¯èƒ½Bçš„çˆ¶é‚€è¯·äººå˜æˆäº†Dï¼Œé‚£æˆ‘ä»¬åŸºäºAå¾€ä¸‹è¿½æº¯çš„é‚€è¯·é“¾è®¡ç®—å‡ºçš„ç»“æœå°±ä¸å‡†ç¡®äº†ã€‚å¯¹äºè¿™ç§æ•°æ®å¹¶å‘æ“ä½œçš„ï¼Œæˆ‘ä»¬çš„è§£å†³æ–¹æ¡ˆè¿˜æ˜¯æ‹†åˆ†æ•°æ®è‡³å°ç²’åº¦å†å¯¹å°ç²’åº¦æ•°æ®çš„ã€æ“ä½œä¸²è¡ŒåŒ–ã€‘ã€‚æˆ‘ä»¬è€ƒè™‘ç°å®æƒ…å†µï¼Œå¤§éƒ¨åˆ†æ™®é€šç”¨æˆ·èƒ½é‚€è¯·åˆ°çš„å¥½å‹é‡çº§å’Œé“¾æ¡å±‚çº§éƒ½ä¸ä¼šå¾ˆå¤§ï¼Œè€Œä¸”åŸºäºæœ€æ—©æ—¶é—´ç®—æœ‰æ•ˆé‚€è¯·çš„åŸåˆ™ï¼Œä¸€æ®µæ—¶é—´ä¹‹å‰è®¡ç®—å¥½çš„é‚€è¯·é“¾æ¡å‡ ä¹ä¸ä¼šå†å‘ç”Ÿå˜åŒ–ï¼Œå¯¼è‡´é‚€è¯·é“¾æ¡å˜æ›´çš„åŸå› å‡ ä¹æ˜¯é€šè¿‡å¤šçº§é‚€è¯·è¿›æ¥çš„æœ€æ–°ç”¨æˆ·å¯¼è‡´çš„å…³ç³»å˜æ›´ï¼Œè‡³æ­¤æˆ‘ä»¬å¯ä»¥è€ƒè™‘å°†å•ä¸ªå¼•æµæ´»åŠ¨ä¸‹é‚€è¯·é“¾æ¡çš„è®¡ç®—è¿‡ç¨‹ä¸²è¡ŒåŒ–ã€‚*æˆ‘ä»¬åœ¨ã€å”¯ä¸€ç”¨æˆ·ã€‘å†…éƒ¨ä¿å­˜è¯¥ç”¨æˆ·åœ¨ä¸åŒæ¥æºä¸‹æ¯”è¾ƒå¾—å‡ºçš„ã€æœ€æ—©çˆ¶é‚€è¯·äººã€‘ä¿¡æ¯ï¼Œå¹¶åœ¨è¿™ä¸€ä¿¡æ¯å‘ç”Ÿå˜æ›´çš„æ—¶å€™ï¼Œå‘å¸ƒã€æœ€æ—©é‚€è¯·äººå˜æ›´ã€‘çš„é¢†åŸŸäº‹ä»¶ï¼Œä½œä¸ºé©±åŠ¨é‚€è¯·é“¾æ¡è®¡ç®—çš„æ•°æ®æ¥æºã€‚*å¤„ç†é¢†åŸŸäº‹ä»¶çš„åœ°æ–¹ï¼Œæˆ‘ä»¬å–çŠ¶æ€å˜æ›´çš„ã€å”¯ä¸€ç”¨æˆ·ã€‘ç›®å‰çš„çˆ¶é‚€è¯·äººæ‰€å½’å±çš„å‘˜å·¥ï¼Œä½œä¸ºå½“å‰ã€å”¯ä¸€ç”¨æˆ·ã€‘åŠã€å”¯ä¸€ç”¨æˆ·ã€‘æ‰€å¤„é‚€è¯·é“¾æ¡ä¸‹å±‚çš„å…¶ä»–äººçš„å½’å±å‘˜å·¥ï¼Œç„¶åè¿›è¡Œå½’å±å‘˜å·¥ä¿¡æ¯çš„æ›´æ–°ã€‚
4. è¯»å†™åˆ†ç¦»æ¨¡å¼ä¸‹ï¼Œä¿¡æ¯åˆå¹¶/é‚€è¯·é“¾æ¡å½’å±çš„è®¡ç®—ç»“æœéƒ½éœ€è¦é€šè¿‡äº‹ä»¶åŒæ­¥åˆ°å…¶ä»–ä¸šåŠ¡ç³»ç»Ÿé‡Œ(EventSourceæ¨¡å¼)ã€‚å…¶ä»–ä¸šåŠ¡ç³»ç»Ÿåœ¨é‡å»ºã€å”¯ä¸€ç”¨æˆ·ã€‘çŠ¶æ€çš„æ—¶å€™ï¼Œå¯ä»¥åŸºäºå”¯ä¸€æ ‡è¯†IDä½œä¸ºåˆ†åŒºé”®ï¼Œé¿å…é‡å»ºè¿‡ç¨‹ä¸­çš„æ•°æ®å†²çªã€‚æ‰€ä»¥è¿™é‡Œæˆ‘ä»¬å¯ä»¥ç»™ã€å”¯ä¸€ç”¨æˆ·ã€‘å®šä¹‰ä¸€ä¸ªUUIDå”¯ä¸€å€¼çš„ä¸šåŠ¡ä¸»é”®æ ‡è¯†ã€‚

åŸºäºä»¥ä¸Šå‡ ç‚¹æ€è€ƒï¼Œæˆ‘ä»¬å®Œæˆäº†ã€å”¯ä¸€ç”¨æˆ·ã€‘é¢†åŸŸæ¨¡å‹çš„å¤§éƒ¨åˆ†çŸ¥è¯†çš„æ•´ç†ã€‚è‡³æ­¤æˆ‘ä»¬å¯ä»¥å¾—å‡ºä»¥ä¸‹èšåˆçš„è®¾è®¡:
```haskell
1. UUIDç”Ÿæˆçš„å”¯ä¸€å€¼ä½œä¸ºã€å”¯ä¸€ç”¨æˆ·ã€‘çš„ä¸šåŠ¡ä¸»é”®ï¼Œè®¾è®¡ä¸ºå€¼å¯¹è±¡(ParticipantsId)
2. ç”¨æˆ·ã€æ˜µç§°ã€‘ï¼Œã€å¤´åƒã€‘ï¼Œã€åœ°åŸŸã€‘ï¼Œã€æ›´æ–°æ—¶é—´ã€‘å¤šå…ƒæ•°æ®éœ€è¦è¢«æ•´ä½“è¯»å†™ï¼Œè®¾è®¡ä¸ºå€¼å¯¹è±¡(ParticipantsProfile)
3. ç”¨æˆ·å½“å‰æœ€æ—©ã€é‚€è¯·äººIDã€‘ã€é‚€è¯·æ—¶é—´ã€‘äºŒå…ƒæ•°æ®éœ€è¦è¢«æ•´ä½“è¯»å†™ï¼Œè®¾è®¡ä¸ºå€¼å¯¹è±¡(ParticipantsInviterInfo)
4. åŸºäºé‚€è¯·é“¾å…³ç³»è®¡ç®—å¾—åˆ°çš„å½’å±å‘˜å·¥ä¿¡æ¯è®¾è®¡ä¸ºå€¼å¯¹è±¡(ParticipantsBelongTo)
5. åœ¨åˆå¹¶æ‹†åˆ†åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬éœ€è¦ä¿ç•™ä¸åŒæ¥æºä¸‹çš„ç”¨æˆ·åŸºç¡€ä¿¡æ¯ï¼Œæˆ‘ä»¬ä½¿ç”¨é›†åˆç±»å‹Map<VisitorSource, ParticipantsProfile>è®°å½•ç»“æ„åŒ–çš„ä¿¡æ¯ï¼Œä½¿ç”¨è‡ªå®šä¹‰çš„jpaè§„èŒƒé‡Œçš„è½¬æ¢æ³¨è§£åœ¨å®é™…è½åº“çš„æ—¶å€™ï¼Œå°†ç»“æ„åŒ–æ•°æ®åºåˆ—åŒ–ä¸ºjsonå­˜å‚¨åˆ°varcharå­—æ®µä¸­
6. ParticipantsProfile/ParticipantsInviterInfoå˜æ›´æ—¶å‘å¸ƒé¢†åŸŸäº‹ä»¶
7. æ¯”è¾ƒæ›´æ–°åŸºç¡€ä¿¡æ¯çš„å†…éƒ¨è¡Œä¸º/æ¯”è¾ƒæ›´æ–°æœ€æ—©çˆ¶é‚€è¯·äººä¿¡æ¯çš„å†…éƒ¨è¡Œä¸º(è¯¦è§ç¤ºä¾‹ä»£ç )
```
èšåˆè®¾è®¡ç¤ºä¾‹ä»£ç :

```java
@Data
@Entity
@DynamicUpdate
@NoArgsConstructor
@AllArgsConstructor
@ToString(callSuper = true)
@EqualsAndHashCode(callSuper = true)
@Table(
        name = "participants_user_info",
        uniqueConstraints = {
        		@UniqueConstraint(columnNames = { "participantsId" })},
        indexes = {
        		@Index(columnList = "taskId,nickName")})
public class ParticipantsInfo extends IdentifiedEntity {
	
	private static final Comparator<ParticipantsProfile> PROFILE_LAST_TIME_COMPARATOR = Comparator.comparing(ParticipantsProfile::getAcquisitionTime).reversed();
	
	private ParticipantsId participantsId;
	private InviteTaskId taskId;
	private ParticipantsInviterInfo inviterInfo;
	private ParticipantsProfile profile;
	private ParticipantsBelongTo belongTo;
	// ä¸åŒæ¥æºä¸‹çš„åŸå§‹ä¿¡æ¯
	@Column(columnDefinition = "varchar(512)")
	@Convert(converter = InviterInfoMap2JsonConveter.class)
	private Map<VisitorSource, ParticipantsInviterInfo> sourceInviterInfo;
	@Column(columnDefinition = "varchar(1024)")
	@Convert(converter = ParticipantsProfileMap2JsonConveter.class)
	private Map<VisitorSource, ParticipantsProfile> sourceParticipantsProfile;
	
	public ParticipantsInfo(
			ParticipantsId participantsId,
			InviteTaskId taskId) {
		this.participantsId = participantsId;
		this.taskId = taskId;
	}
	
	/**
	 * å°è¯•åˆå¹¶æŒ‡å®šçš„ç”¨æˆ·
	 * @param visitorId 
	 * @param curProfile 
	 * 
	 * @param belongTo
	 * @param participantsId2 
	 */
	public void tryMerge(
			VisitorId visitorId, 
			InviterInfo inviterInfo,
			ParticipantsProfile curProfile,
			ParticipantsId mergedParticipantsId) {
		this.appendVisitorId(visitorId);
		if (inviterInfo != null) {
			this.updateInviterInfo(
					visitorId.getVisitorSource(), 
					inviterInfo);
		}
		if (curProfile != null) {
			this.updateProfile(
					visitorId.getVisitorSource(), 
					curProfile);
		}
		DomainEventPublisher.publish(
				new ParticipantsMerged(
						this.participantsId,
						this.taskId,
						this.inviterInfo,
						mergedParticipantsId,
						LocalDateTime.now()));
	}
	
	// æ›´æ–°ã€å”¯ä¸€ç”¨æˆ·ã€‘çˆ¶é‚€è¯·äººçš„è¡Œä¸º
	public void updateInviterInfo(
			VisitorSource visitorSource, 
			InviterInfo inviterInfo) {
		this.updateVisitorSourceInviterInfo(
				visitorSource,
				inviterInfo);
		this.reCompareFirstInivterInfo();
	}

	// æ›´æ–°ã€å”¯ä¸€ç”¨æˆ·ã€‘åŸºäºé‚€è¯·é“¾æ¡è®¡ç®—å¾—åˆ°çš„å½’å±ä¿¡æ¯è¡Œä¸º
	public void updateBelongTo(
			ParticipantsBelongTo belongTo) {
		if ((this.belongTo == null)
				|| (this.belongTo != null && !this.belongTo.equals(belongTo))) {
			this.belongTo = belongTo;
			DomainEventPublisher.publish(
					new ParticipantsBelongToChanged(
							participantsId, 
							taskId, 
							belongTo));
		}
	}

	// æ›´æ–°ã€å”¯ä¸€ç”¨æˆ·ã€‘åŸºç¡€ä¿¡æ¯çš„è¡Œä¸º
	public void updateProfile(
			VisitorSource visitorSource, 
			ParticipantsProfile profile) {
		boolean isFromEmpWay = 
				profile.isProfileChangeFromEmpWay();
		boolean profileHasChange =
				this.updateSourceParticipantsProfile(
						visitorSource,
						profile);
		if (profileHasChange) {
			boolean matchSideNeedQuit = 
					this.hasMatched() && isFromEmpWay;
			if (matchSideNeedQuit) {
				this.matchSideQuitMapping(
						visitorSource,
						profile.toNormalWay());
			}
			ParticipantsProfile reChooseProfile = this.reChooseProfile();
			if (this.profile == null
					|| matchSideNeedQuit
					|| !this.profile.profileMaybeSame(reChooseProfile)) {
				this.profile = reChooseProfile;
				DomainEventPublisher.publish(
						new ParticipantsProfileChanged(
								this.participantsId,
								this.taskId,
								this.profile));
			}
		}
	}

	private ParticipantsProfile reChooseProfile() {
		return this.sourceParticipantsProfile()
				.values()
				.stream()
				.sorted(PROFILE_LAST_TIME_COMPARATOR)
				.limit(1)
				.findFirst()
				.orElse(this.profile);
	}

	private boolean updateSourceParticipantsProfile(
			VisitorSource visitorSource, 
			ParticipantsProfile profile) {
		ParticipantsProfile preValue = 
				this.sourceParticipantsProfile()
				.put(
						visitorSource, 
						profile);
		return preValue == null || !preValue.profileMaybeSame(profile);
	}

	private Map<VisitorSource, ParticipantsProfile> sourceParticipantsProfile() {
		if (this.sourceParticipantsProfile == null) {
			this.sourceParticipantsProfile = 
					Maps.newHashMapWithExpectedSize(2);
		}
		return this.sourceParticipantsProfile;
	}

	private void matchSideQuitMapping(
			VisitorSource visitorSource, 
			ParticipantsProfile quitSideProfile) {
		VisitorId quitSideVisitorId = null;
		if (visitorSource == VisitorSource.PV) {
			quitSideVisitorId = this.wxUnionId.asVisitorId();
			this.resetWxUnionId();
		} else if (visitorSource == VisitorSource.GROUP) {
			quitSideVisitorId = this.wxMemberId.asVisitorId();
			this.resetWxMemberId();
		} else {
			return;
		}
		this.removeVisitorSourceProfile(visitorSource);
		InviterInfo quitSideInviterInfo =
				this.removeVisitorSourceInviterInfo(visitorSource);
		this.reCompareFirstInivterInfo();
		DomainEventPublisher.publish(
				new ParticipantsMatchSideQuit(
						this.taskId,
						quitSideVisitorId,
						quitSideProfile,
						quitSideInviterInfo));
	}

	private void removeVisitorTypeSourceProfile(
			VisitorSource visitorSource) {
		this.sourceParticipantsProfile().remove(visitorSource);
	}

	public boolean maybeSame(
			ParticipantsProfile profile) {
		return this.profile.profileMaybeSame(profile);
	}

	private void reCompareFirstInivterInfo() {
		InviterInfo compareFirsInviterInfo = 
				this.compareFirstInviterInfo();
		if (this.inviterInfo == null
				|| !this.inviterInfo.equals(compareFirsInviterInfo)) {
			this.inviterInfo = compareFirsInviterInfo;
			DomainEventPublisher.publish(
					new ParticipantsInviterInfoChanged(
							this.participantsId,
							this.taskId,
							this.wxUnionId,
							this.wxMemberId,
							this.inviterInfo));
		}
	}
	
	private void updateVisitorSourceInviterInfo(
			VisitorSource visitorType, 
			InviterInfo inviterInfo) {
		if (visitorSource == null) {
			return;
		}
		Map<VisitorSource, InviterInfo> sourceBelongToCache = this.sourceInviterInfoCache();
		if (sourceBelongToCache.containsKey(visitorSource)) {
			sourceBelongToCache.compute(
					visitorSource, 
					(key, old) -> {
						return old.isBefore(
								inviterInfo.getInviteTime()) ? old : inviterInfo;
			});
		} else {
			sourceBelongToCache.put(visitorSource, inviterInfo);
		}
	}
	
	private InviterInfo compareFirstInviterInfo() {
		return 
				this.sourceInviterInfoCache()
				.entrySet()
				.stream()
				.map(Entry::getValue)
				.sorted(Comparator.comparing(InviterInfo::getInviteTime))
				.findFirst()
				.orElse(null);
	}

	private InviterInfo removeVisitorSourceInviterInfo(
			VisitorSource visitorSource) {
		return this.sourceInviterInfoCache().remove(visitorSource);
	}
	
	public void appendVisitorId(
			VisitorId visitorId) {
		if (visitorId.getVisitorSource() == VisitorSource.GROUP) {
			this.tryAppendWxMemberId(
					visitorId.asWxMemberId());
		} else if(visitorId.getVisitorSource() == VisitorSource.PV) {
			this.tryAppendWxUnionId(
					visitorId.asWxUnionId());
		}
	}

	private void tryAppendWxUnionId(
			WxUnionId wxUnionId) {
		if (wxUnionId == null) {
			return;
		}
		if (this.wxUnionId == null
				|| !this.wxUnionId.equals(wxUnionId)) {
			this.wxUnionId = wxUnionId;
			this.notifyVisitorIdChanged();
		}
	}

	private void tryAppendWxMemberId(
			WxMemberId wxMemberId) {
		if (wxMemberId == null) {
			return;
		}
		if (this.wxMemberId == null
				|| !this.wxMemberId.equals(wxMemberId)) {
			this.wxMemberId = wxMemberId;
			this.notifyVisitorIdChanged();
		}
	}
	
	private void resetWxUnionId() {
		WxUnionId preWxUnionId = this.wxUnionId;
		this.wxUnionId = null;
		DomainEventPublisher.publish(
				new ParticipantsWxUnionIdReseted(
						this.participantsId,
						this.taskId,
						this.wxMemberId,
						preWxUnionId));
		this.notifyVisitorIdChanged();
	}
	
	private void resetWxMemberId() {
		WxMemberId preWxMemberId = this.wxMemberId;
		this.wxMemberId = null;
		DomainEventPublisher.publish(
				new ParticipantsWxMemberIdReseted(
						this.participantsId,
						this.taskId,
						this.wxUnionId,
						preWxMemberId));
		this.notifyVisitorIdChanged();
	}

	private void notifyVisitorIdChanged() {
		DomainEventPublisher.publish(
				new ParticipantsMatchedVisitorIdChanged(
						this.participantsId,
						this.taskId,
						this.wxUnionId,
						this.wxMemberId));
	}

}
```
ä¸²è¡Œå¤„ç†é‚€è¯·é“¾æ¡è®¡ç®—çš„äº‹ä»¶æ¶ˆè´¹ç¤ºä¾‹ä»£ç :

```java
 
 	// åŸºäºmysql8.0+æ”¯æŒçš„é€’å½’æŸ¥è¯¢å¯ä»¥å¿«é€Ÿè·å–ä»¥å½“å‰ã€å”¯ä¸€ç”¨æˆ·ã€‘ä¸ºèµ·ç‚¹çš„é‚€è¯·é“¾æ¡ä¿¡æ¯
	@EventSynchronizer(
			partition = 30, 
			clientConcurrency = 10)
	@ShardingKeyExpression(
			// æ§åˆ¶å•ä¸€å¼•æµæ´»åŠ¨ä¸‹é‚€è¯·é“¾æ¡è®¡ç®—æ“ä½œçš„ä¸²è¡ŒåŒ–
			el ="#event[taskId]")
	public void updateParticipantsBelongChain(
			ParticipantsInviterInfoChanged participantsInviterInfoChanged) {
		String traceId = UUID.randomUUID().toString();
		this.app.listAllInvitedChain(
				participantsInviterInfoChanged.getParticipantsId())
		.stream()
		.forEach(tryUpdateInvitedPar -> {
			log.info(
					"[{}] pk:{} inviterId:{}, belongTo:{}", 
					traceId,
					tryUpdateInvitedPar.getPkId(),
					tryUpdateInvitedPar.getInviterId(),
					tryUpdateInvitedPar.getBelongTo());
			this.app.juedgeAndUpdateParticipantsBelongTo(
					tryUpdateInvitedPar.getPkId(),
					tryUpdateInvitedPar.getInviterId(),
					tryUpdateInvitedPar.belongToInfo());
		});
	}
```

## 4. å°æ€»ç»“
æˆ‘ä»¬å¯ä»¥ç®€å•æ•´ç†å‡ºä¸€ä»½ä¸šåŠ¡é¢†åŸŸæ¨¡å‹ä¹‹é—´äº‹ä»¶ç¼–æ’çš„å…³ç³»å›¾ï¼Œç”¨äºä¸šåŠ¡é¢†åŸŸçŸ¥è¯†çš„è¯´æ˜å’Œå­˜æ¡£:
![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://img-blog.csdnimg.cn/7fdb45ce1072496ca4400dc2f08156b9.png)

# äºŒã€åŸºç¡€ä¾èµ–-é›†ç¾¤å†…éƒ¨äº‹ä»¶å‘å¸ƒè®¢é˜…
ä»ä¸Šé¢çš„å†…å®¹å¯ä»¥çœ‹å‡ºï¼Œé¢†åŸŸäº‹ä»¶æ˜¯DDDæ¶æ„é‡Œçš„ä¸€ç­‰å…¬æ°‘ï¼Œå¯ä»¥é€šè¿‡é¢†åŸŸäº‹ä»¶æ¥ç¼–æ’è§£è€¦ä¸åŒçš„ä¸šåŠ¡ï¼Œä»¥æœ€ç»ˆä¸€è‡´çš„æ–¹å¼åŒæ­¥æ•°æ®ï¼Œå‰Šå³°ä¸²è¡Œå¤„ç†æ•°æ®ï¼Œé€šè¿‡äº‹ä»¶æ—¥å¿—è¿½æº¯èšåˆçŠ¶æ€å˜æ›´çš„ç”Ÿå‘½å‘¨æœŸç­‰ã€‚
åœ¨åŸºç¡€ä¾èµ–å±‚é‡Œï¼Œæˆ‘ä»¬éœ€è¦å¼•å…¥çœŸæ­£çš„å‘å¸ƒè®¢é˜…åŠŸèƒ½ã€‚å¾ˆå®¹æ˜“æƒ³åˆ°çš„ä¾¿æ˜¯åŸºäºæ¶ˆæ¯é˜Ÿåˆ—æ¥å®Œæˆï¼Œç›®å‰å¸‚é¢ä¸Šæµè¡Œçš„æ¶ˆæ¯é˜Ÿåˆ—äº§å“æœ‰Kafka, ActivtyMQ, RabbitMQç­‰ã€‚è¿™é‡Œä»¥å®Œæ•´å¼•å…¥kafkaæ¡†æ¶æ¥å®ç°äº‹ä»¶å‘å¸ƒè®¢é˜…åŠŸèƒ½çš„æµç¨‹ä½œä¸ºå®ä¾‹ï¼Œå¹¶ä»¥éƒ¨ç½²å’Œå¼€å‘è¿‡ç¨‹ä¸­çš„ä¸€äº›ã€é—®é¢˜ã€‘æ¥è§£é‡Šä¸ºä»€ä¹ˆéœ€è¦é‡å¤é€ ä¸€ä¸ªã€äº‹ä»¶å‘å¸ƒè®¢é˜…ã€‘çš„è½®å­ã€‚

```java
1. éƒ¨ç½²
	kafkaé«˜å¯ç”¨çš„åŸºç¡€é¦–å…ˆæ˜¯é›†ç¾¤åŒ–ï¼Œæ•°æ®åˆ†åŒºï¼Œä¸»ä»å‰¯æœ¬é›†ç­‰é«˜å¯ç”¨æ¶æ„éƒ½ä¾èµ–äºé›†ç¾¤ç¯å¢ƒã€‚
	è€ŒåŒæ—¶ï¼Œkafkaè¿˜éœ€åŸºäºzookeeperå®ç°é›†ç¾¤åè°ƒï¼Œleaderé€‰ä¸¾ï¼Œé…ç½®ç®¡ç†å’Œæ¶ˆè´¹ç»„ç®¡ç†ç­‰åŠŸèƒ½ï¼Œæ‰€ä»¥åœ¨éƒ¨ç½²kafkaå®ä¾‹ä¹‹å‰ï¼Œéœ€è¦æå‰éƒ¨ç½²å¥½zookeeperé›†ç¾¤ã€‚
	æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè¦è½åœ°åŸºç¡€çš„äº‹ä»¶å‘å¸ƒè®¢é˜…åŠŸèƒ½ï¼Œåœ¨éƒ¨ç½²è¿™ä¸€æ­¥å°±éœ€è¦æ¶ˆè€—è¾ƒå¤šçš„æœºå™¨èµ„æºã€‚
	å¯¹äºä¸­å°å‹é¡¹ç›®è€Œè¨€ï¼Œä¸€æ–¹é¢è¿½æ±‚å¿«é€Ÿéƒ¨ç½²ï¼Œå¦ä¸€æ–¹é¢å°±æ˜¯å¯ç”¨èµ„æºè¾ƒä¸ºç´§å¼ ï¼Œä¾èµ–æœåŠ¡å ç”¨çš„èµ„æºå¤šäº†ï¼Œç”¨äºé¡¹ç›®éƒ¨ç½²çš„èµ„æºå°±ä¼šå‡å°‘ã€‚

2. kafkaæœåŠ¡ç®¡ç†
	å¦‚æœkafkaé›†ç¾¤ä½œä¸ºä¸€ä¸ªå…¬å…±æœåŠ¡ä½¿ç”¨ï¼ŒåŠ¿å¿…éœ€è¦å¯¹å…¶è¿›è¡Œç›‘æ§å’Œå¼‚å¸¸å‘Šè­¦ã€‚æ¯”å¦‚èŠ‚ç‚¹å­˜æ´»ï¼Œæœºå™¨å†…å­˜ç£ç›˜cpuå‹åŠ›ç­‰åŸºç¡€æŒ‡æ ‡ã€‚
	é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜éœ€è¦è€ƒè™‘å…¬å…±æœåŠ¡é‡Œä¸åŒä¸šåŠ¡çš„éš”ç¦»é—®é¢˜ï¼Œä¸åŒä¸šåŠ¡ç³»ç»Ÿå¯èƒ½æœ‰ä¸åŒçš„æ¶ˆè´¹ä¸»é¢˜åŠä¸åŒçš„æ¶ˆè´¹åœºæ™¯ï¼Œ
	Kafkaä¸åŒçš„æ¶ˆè´¹ä¸»é¢˜çš„æ¶ˆè´¹é€Ÿç‡å·®å¼‚å¤§å¯èƒ½ä¼šå½±å“æ•´ä¸ªé›†ç¾¤çš„ç¨³å®šæ€§ï¼Œå¦‚æ¶ˆè´¹é€Ÿç‡å¿«çš„å¯èƒ½ä¼šæ›´å¤šçš„å ç”¨ç½‘ç»œå¸¦å®½ï¼Œç£ç›˜IOï¼Œé€ æˆèµ„æºä½¿ç”¨ä¸å‡è¡¡ï¼›
	æ¶ˆè´¹é€Ÿç‡æ…¢çš„å¯èƒ½ä¼šå¯¼è‡´é›†ç¾¤äº‹ä»¶ç§¯å‹ï¼Œæ¶ˆè€—é›†ç¾¤è¿‡å¤šçš„å†…å­˜ç©ºé—´è¿›è€Œå½±å“å…¶ä»–ä¸šåŠ¡çš„äº‹ä»¶æ¶ˆè´¹ã€‚
	å°½ç®¡å¯ä»¥é€šè¿‡è°ƒæ•´åˆ†åŒºæ•°é‡ï¼Œå¢åŠ æ¶ˆè´¹èŠ‚ç‚¹ç­‰æ–¹å¼æ¥è°ƒä¼˜è¿™ç±»é—®é¢˜ï¼Œä½†è¿™ç±»æ“ä½œå¤§å¤šæ»åäºé—®é¢˜çš„å‘ç”Ÿã€‚

3. å¼€å‘
	1. 	kafkaæ— è®ºåœ¨å‘å¸ƒè¿˜æ˜¯è®¢é˜…çš„æ—¶å€™éƒ½éœ€è¦æ˜ç¡®çŸ¥é“ç›®æ ‡ä¸»é¢˜çš„æ ‡è¯†åç§°ï¼Œå¹¶éœ€è¦æå‰åˆ›å»ºå¥½(æˆ–è€…é€šè¿‡åŠ¨æ€ä¸»é¢˜çš„æ–¹å¼åˆ›å»º)ã€‚
		è¿™å°±éœ€è¦æˆ‘ä»¬æ¯æ¬¡åœ¨å‘å¸ƒè®¢é˜…é¢†åŸŸäº‹ä»¶çš„æ—¶å€™ï¼ŒæŒ‡å®šå¥½å¯¹åº”çš„ä¸»é¢˜ã€‚
		åœ¨ä¸»é¢˜ä¸ç»†åˆ†çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šä»¥å½“å‰é¢†åŸŸæœåŠ¡åç§°åˆ›å»ºä¸»é¢˜ç”¨äºæœ¬ç³»ç»Ÿå†…æ‰€æœ‰èšåˆäº‹ä»¶å‘å¸ƒï¼Œç„¶åæ‰€æœ‰éœ€è¦æ¶ˆè´¹è¿™ä¸ªé¢†åŸŸæœåŠ¡çš„ç³»ç»Ÿéƒ½ç›‘å¬è¿™ä¸ªä¸»é¢˜ã€‚
		è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±è¦è€ƒè™‘åˆ°ã€KafkaåŒä¸€æ¡æ¶ˆæ¯åªèƒ½è¢«åŒä¸€ä¸ªæ¶ˆè´¹ç»„ä¸‹çš„æŸä¸€ä¸ªæ¶ˆè´¹è€…æ¶ˆè´¹ã€‘ï¼Œé€šè¿‡ä¸ºæ¯ä¸ªæ¶ˆè´¹ç³»ç»ŸæŒ‡å®šå”¯ä¸€æ¶ˆè´¹ç»„ï¼Œ
		ç„¶åå…¨é‡è·å–æ‰€æœ‰é¢†åŸŸäº‹ä»¶å†æŒ‰äº‹ä»¶ç±»å‹åˆ†å‘ç»™ä¸åŒçš„æœ¬åœ°å¤„ç†æ–¹æ³•è¿›è¡Œæ¶ˆè´¹ã€‚
		åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œä¸€æ˜¯kafkaæ¶ˆè´¹ç»„æ˜¯ä¸ªé‡é‡çº§æ¦‚å¿µï¼Œè¿‡å¤šåˆ›å»ºä¼šæ¶ˆè€—æ›´å¤šçš„æœºå™¨èµ„æºï¼›å†å°±æ˜¯äº‹ä»¶æŠ•é€’ç²’åº¦è¾ƒå¤§ï¼Œå¯èƒ½æœ‰äº›ä¸šåŠ¡ç³»ç»Ÿåªå…³æ³¨ä¸€ä¸¤ä¸ªé¢†åŸŸäº‹ä»¶ç±»å‹ï¼Œ
		å´éœ€è¦è®¢é˜…è·å–å…¨é‡çš„äº‹ä»¶æ•°æ®ï¼Œåœ¨æŸä¸€ç±»å‹äº‹ä»¶é‡çº§è¾ƒå¤§çš„æƒ…å†µä¸‹ï¼ŒåŠ¿å¿…ä¼šå¯¹å…¶ä»–ç±»å‹çš„äº‹ä»¶æ¶ˆè´¹é€ æˆå½±å“ã€‚
		æœ€ååŸºäºè¿™ç§æ–¹å¼æ²¡æ³•åˆç†çš„è®¾ç½®åˆ†åŒºæ•°ä»¥æ»¡è¶³ä¸åŒæ¶ˆè´¹é€»è¾‘çš„æ€§èƒ½è¦æ±‚ã€‚
	2.	æˆ‘ä»¬ä¼šåŸºäºkafkaæ¶ˆæ¯äº‹åŠ¡æ¥ä¿è¯äº‹ä»¶å‘é€çš„å‡†ç¡®å’Œå¹‚ç­‰ï¼Œé€šè¿‡é¢„æäº¤ï¼Œæœ¬åœ°ä¸šåŠ¡äº‹åŠ¡æ‰§è¡Œç»“æœæ¥æ§åˆ¶äº‹ä»¶äº‹åŠ¡çš„æäº¤å’Œå›æ»šï¼ŒRabbitMQåœ¨æ­¤åŸºç¡€ä¸Š
		è¿˜å¢åŠ äº†æœ¬åœ°äº‹åŠ¡æ‰§è¡Œç»“æœæŸ¥è¯¢çš„å›è°ƒå…¥å£ã€‚ä½†æœ¬è´¨ä¸Šä¸ºäº†ä¿è¯kafakaäº‹ä»¶å‘é€å’Œæœ¬åœ°ä¸šåŠ¡äº‹åŠ¡å¼ºä¸€è‡´çš„æäº¤æˆ–è€…å›æ»šï¼Œè¿˜æ˜¯ä½¿ç”¨äº†åˆ†å¸ƒå¼äº‹åŠ¡çš„æ¨¡å¼ã€‚
		è€Œä¸”å‘å¸ƒè¿‡ç¨‹å­˜åœ¨å¤±è´¥çš„é£é™©(Brokerå®•æœºæˆ–è€…å‰¯æœ¬é›†å†™å…¥å¤±è´¥æˆ–è€…zookeeperå®•æœºç­‰)ã€‚æœ¬åœ°ä¸šåŠ¡çš„æ‰§è¡Œå’Œè½¯ä»¶ç¡¬ä»¶çš„æ€§èƒ½è€¦åˆåœ¨äº†ä¸€èµ·ã€‚
```
é€šè¿‡ä»¥ä¸Šå‡ ç‚¹çš„è¯´æ˜ï¼Œæˆ‘ä»¬å¸Œæœ›åœ¨ä¸­å°å‹é¡¹ç›®é‡Œèƒ½åšåˆ°

	1. éƒ¨ç½²æœåŠ¡ä¾èµ–ç®€å•ï¼Œå°½é‡å‡å°‘èµ„æºçš„å ç”¨
	2. ä¸šåŠ¡ç³»ç»Ÿä¹‹é—´åšåˆ°éš”ç¦»ï¼Œé¿å…ç»ç”±å…¬å…±æœåŠ¡æ‰©æ•£é€ æˆçš„çº§è”å½±å“
	3. å‘å¸ƒæµç¨‹ç®€å•ï¼Œæœ‰è½»é‡çº§äº‹åŠ¡ä¿éšœï¼Œæ”¯æŒåˆ†åŒºæ¶ˆè´¹ï¼Œäº‹ä»¶å†…å®¹è¿‡æ»¤
	4. é«˜å¯ç”¨(åšåˆ°è‡ªåŠ¨æ•…éšœè½¬ç§»)
# ä¸‰ã€åŸºç¡€ä¾èµ–-åˆ†å¸ƒå¼ä»»åŠ¡è°ƒåº¦

# æ€»ç»“

=======
<?xml version="1.0" encoding="UTF-8"?>
<metadata>
  <groupId>com.zero.ddd</groupId>
  <artifactId>ddd-akka-cluster-toolset</artifactId>
  <versioning>
    <release>0.0.3-SNATSHOT</release>
    <versions>
      <version>0.0.2-SNAPSHOT</version>
      <version>0.0.3-SNATSHOT</version>
    </versions>
    <lastUpdated>20231103101930</lastUpdated>
  </versioning>
</metadata>
>>>>>>> snapshot
